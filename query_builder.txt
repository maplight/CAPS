To build the database query there are several processes that occur first to build a series of subqueries.  The query itself is also executed on a smry table that just has the indexed and searchable values.

Step 1: Build the contributor name search query:
  If the All contributors button is checked no contributor name filter is built
  If the Just these contributors button is checked the data in in the text box is split into individual words and the following SQL is built from it:
    MATCH (contributions_search.DonorNameNormalized, contributions_search.DonorEmployerNormalized, contributions_search.DonorOrganization) AGAINST ('list of words' IN BOOLEAN MODE)
    -- this is a special query option only available in certain table types and with a special index.  It's a fast text search basically and I have it set to do an AND on all the words in the list - i.e. Dan Newman looks for both dan AND newman in the same field.
    -- by default mySQL will ignore any word that is less then 4 characters and treat it as a wild card, along with certain words.  I have adjusted the minimum word length to be 2 characters, but this will have to be explained in the install documentation for the state to do the same.

Step 2: Build the contributor location query
  If All states is not selected:
    contributions_search.DonorState = 'statecode'

Step 3: Candidate contributions query
  If the Candidates box is checked
    contributions_search.CandidateContribution = 'Y';

Step 4 - only occurs if the Candidate contributions box is checked off:
  If the All candidates button is selected no candidate filter is built
  If the Search candidates button is selected:
    If a candidate is NOT selected in the select candidate drop down (i.e. it says Select Candidate still) then use the search text box items and build the following SQL:
      MATCH (contributions_search.RecipientCandidateNameNormalized) AGAINST ('list of words' IN BOOLEAN MODE)
      -- see explaination of this search in Step 1
    If a candidate is selected in the select candidate drop down use this query:
      contributions_search.RecipientCandidateNameNormalized = 'selected candidate'
  If the offices selection button is selected:
    contributions_search.RecipientCandidateOffice = 'office selected'

Step 5:
  If the Ballot Measures box is checked
    contributions_search.BallotMeasureContribution = 'Y'

Step 6 - only occurs if the Ballot measures box is checked off:
  If the Search propositions box has been changed (text was entered) and the propositions drop down has All propositions selected search on the words entered:
    MATCH (contributions_search.Target) AGAINST ('list of words' IN BOOLEAN MODE
    -- see explaination of this search in Step 1
  If the Search propositions box has not been changed (no text entered) and the propositions drop down box selected is an election:
    contributions_search.Election = 'election date'
  If the Search propositions box has not been changed (no text entered)
    contributions_search.Election = 'propostion election' AND contributions_search.Target = 'proposition text'
  If Support is selected
    contributions_search.Position = 'SUPPORT'
  If Oppose is selected
    contributions_search.Position = 'OPPOSE'
  If Exclude contributions between allied committees is checked off
    contributions_search.AlliedCommittee = 'N'

Step 7 - only occurs if the Committees box is checked off and Just these committees button is selected
  MATCH (contributions_search.RecipientCommitteeNameNormalized) AGAINST ('list of words' IN BOOLEAN MODE)

Step 8 - If the Date Range button is selected
  contributions_search.TransactionStartDate >= 'start date' AND contributions_search.TransactionEndDate <= 'end date'";

Step 9 - If the Election Cycles button is selected
  Each of the selected cycles are connected via an OR with contributions_search.ElectionCycle = cycle start


All of the above queries are put together with AND and then put into this query:
SELECT contributions.* FROM contributions INNER JOIN contributions_search USING(id) WHERE ...

